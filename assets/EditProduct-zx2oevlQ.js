import{_,u as W,m,z as q,c as z,o as G,B as J,b as T,w as k,d as K,e as i,g as w,f as r,T as U,i as d,x,t as c,h as g,k as h,p as H,q as p,v as y,F as V,j as N,y as I,A as Q}from"./index-CSEyxdT9.js";import{M as X,u as Y}from"./imageUpload-BcmgLVOm.js";import{_ as Z}from"./AppLayout-B6hHIpEb.js";import{L as tt}from"./Loader-l99-MrMN.js";import{_ as et}from"./ErrorMessage-gaV-nPEj.js";import"./Footer-CwoNZgPF.js";const rt={key:0,class:"fixed left-4 top-20 sm:left-8 sm:top-24 bg-red-500 dark:bg-red-600 text-white px-4 py-3 rounded-lg shadow-lg text-sm font-medium max-w-sm animate-pulse z-50"},at={key:0,class:"fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-green-500 dark:bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg text-sm font-medium max-w-sm animate-bounce z-50"},st={class:"max-w-2xl mx-auto"},ot={class:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 sm:p-8"},it={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},lt=["value"],dt={key:0,class:"mt-3"},nt={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},ut={class:"font-semibold text-primary"},mt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},gt=["value"],pt={key:0,class:"mt-2"},ct=["src"],bt={key:0,class:"text-xs text-red-500 dark:text-red-400 mt-2"},xt={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4"},yt=["disabled"],ft={__name:"EditProduct",setup(vt){const P=J(),E=K(),l=W(),O=X,B=m(!0),$=m(!1),L=m(""),C=m(""),n=m(""),u=m(""),b=m(""),f=m(""),S=m(""),a=q({title:"",description:"",category:"",price:0,stock:0,unit:"units",thumbnail:""}),j=s=>s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():"",A=z(()=>{if(!a.price)return"KES 0.00";const s=(a.price*129.6).toFixed(2),[t,e]=s.split(".");return"KES "+t.replace(/\B(?=(\d{3})+(?!\d))/g,",")+"."+e}),D=async()=>{if(L.value="",C.value="",n.value="",!a.title.trim()){n.value="Please enter a product title",v();return}if(!a.description.trim()){n.value="Please enter a product description",v();return}if(!u.value){n.value="Please select a category",v();return}if(u.value==="Other"&&!a.category.trim()){n.value="Please enter a custom category name",v();return}if(!a.thumbnail.trim()&&!f.value){n.value="Please provide a thumbnail URL or upload an image",v();return}const s=u.value==="Other"?a.category.toLowerCase():u.value;l.addCategory(s);let t=a.thumbnail;f.value&&(t=f.value);const e=P.params.id,o=await l.updateProduct(e,{title:a.title,description:a.description,category:s,price:a.price,stock:a.stock,unit:a.unit,thumbnail:t});o.success?(Q().addNotification("Product updated successfully!","success",3e3),await new Promise(R=>setTimeout(R,500)),E.push("/products")):L.value=o.error||"Failed to update product"},v=()=>{setTimeout(()=>{n.value=""},3e3)},M=()=>{if(S.value)return S.value;if(a.thumbnail){if(a.thumbnail.startsWith("data:"))return a.thumbnail;try{const s=JSON.parse(localStorage.getItem("aliensoft_uploaded_images")||"[]"),t=a.thumbnail.split("/").pop(),e=s.find(o=>o.filename===t);if(e&&e.dataUrl)return e.dataUrl}catch(s){console.error("Failed to get image source:",s)}return a.thumbnail}return""},F=async s=>{var o;b.value="";const t=(o=s.target.files)==null?void 0:o[0];if(!t)return;const e=await Y(t);e.success?(f.value=e.base64,S.value=e.dataUrl,b.value=""):(b.value=e.error,f.value="",setTimeout(()=>{b.value=""},3e3))};return G(async()=>{const s=P.params.id,t=Number(s);let e=l.products.find(o=>o.id===t);if(!e&&l.currentProduct&&l.currentProduct.id===t&&(e=l.currentProduct),e||(e=await l.fetchProductById(s)),e){Object.assign(a,{title:e.title||"",description:e.description||"",category:e.category||"",price:e.price||0,stock:e.stock||0,unit:e.unit||"units",thumbnail:e.thumbnail||""});const o=e.category||"";l.categories.includes(o.toLowerCase())?u.value=o.toLowerCase():o&&(u.value="Other")}B.value=!1}),(s,t)=>(i(),T(Z,null,{default:k(()=>[w(U,{name:"slide-in-left"},{default:k(()=>[n.value?(i(),d("div",rt," ðŸ”´ "+c(n.value),1)):x("",!0)]),_:1}),w(U,{name:"slide-up"},{default:k(()=>[C.value?(i(),d("div",at," âœ“ "+c(C.value),1)):x("",!0)]),_:1}),r("div",st,[r("button",{onClick:t[0]||(t[0]=e=>g(E).push(`/products/${g(P).params.id}`)),class:"mb-4 sm:mb-6 inline-flex items-center gap-2 px-4 sm:px-5 py-2 sm:py-2.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all font-medium text-sm sm:text-base border border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 shadow-sm hover:shadow"},[...t[11]||(t[11]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),h(" Back to Product ",-1)])]),t[26]||(t[26]=r("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6"},"Edit Product",-1)),r("div",ot,[w(et,{message:g(l).error},null,8,["message"]),B.value&&!a.title?(i(),T(tt,{key:0})):(i(),d("form",{key:1,onSubmit:H(D,["prevent"]),class:"space-y-4 sm:space-y-6"},[r("div",null,[t[12]||(t[12]=r("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[h(" Title "),r("span",{class:"text-red-500"},"*")],-1)),p(r("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>a.title=e),type:"text",required:"",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"Enter product title"},null,512),[[y,a.title]])]),r("div",null,[t[13]||(t[13]=r("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[h(" Description "),r("span",{class:"text-red-500"},"*")],-1)),p(r("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=e=>a.description=e),rows:"4",required:"",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"Enter product description"},null,512),[[y,a.description]])]),r("div",it,[r("div",null,[t[17]||(t[17]=r("label",{for:"category",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[h(" Category "),r("span",{class:"text-red-500"},"*")],-1)),p(r("select",{id:"category","onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white"},[t[14]||(t[14]=r("option",{value:""},"-- Select a category --",-1)),(i(!0),d(V,null,N(g(l).categories,e=>(i(),d("option",{key:e,value:e},c(j(e)),9,lt))),128)),t[15]||(t[15]=r("option",{value:"Other"},"Other",-1))],512),[[I,u.value]]),w(U,{name:"fade-down"},{default:k(()=>[u.value==="Other"?(i(),d("div",dt,[p(r("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>a.category=e),type:"text",placeholder:"Enter custom category",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white"},null,512),[[y,a.category]]),t[16]||(t[16]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Enter a custom category name",-1))])):x("",!0)]),_:1})]),r("div",null,[t[19]||(t[19]=r("label",{for:"price",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Price (USD) ",-1)),p(r("input",{id:"price","onUpdate:modelValue":t[5]||(t[5]=e=>a.price=e),type:"number",step:"0.01",min:"0",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"0.00"},null,512),[[y,a.price,void 0,{number:!0}]]),a.price?(i(),d("div",nt,[t[18]||(t[18]=h(" Converts to: ",-1)),r("span",ut,c(A.value),1)])):x("",!0)])]),r("div",mt,[r("div",null,[t[20]||(t[20]=r("label",{for:"stock",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Stock ",-1)),p(r("input",{id:"stock","onUpdate:modelValue":t[6]||(t[6]=e=>a.stock=e),type:"number",min:"0",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"0"},null,512),[[y,a.stock,void 0,{number:!0}]])]),r("div",null,[t[21]||(t[21]=r("label",{for:"unit",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Measurement Unit ",-1)),p(r("select",{id:"unit","onUpdate:modelValue":t[7]||(t[7]=e=>a.unit=e),class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white"},[(i(!0),d(V,null,N(g(O),e=>(i(),d("option",{key:e.value,value:e.value},c(e.label),9,gt))),128))],512),[[I,a.unit]])])]),r("div",null,[t[22]||(t[22]=r("label",{for:"thumbnail",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Thumbnail URL ",-1)),p(r("input",{id:"thumbnail","onUpdate:modelValue":t[8]||(t[8]=e=>a.thumbnail=e),type:"text",class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"https://example.com/image.jpg (or upload below)"},null,512),[[y,a.thumbnail]]),t[23]||(t[23]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Optional if image is uploaded",-1)),M()?(i(),d("div",pt,[r("img",{src:M(),alt:"Preview",class:"w-20 sm:w-24 h-20 sm:h-24 object-cover rounded border dark:border-gray-600",onError:t[9]||(t[9]=e=>$.value=!0)},null,40,ct)])):x("",!0)]),r("div",null,[t[24]||(t[24]=r("label",{for:"imageUploadEdit",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Upload Image ",-1)),r("input",{id:"imageUploadEdit",type:"file",accept:"image/*",onChange:F,class:"w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm sm:text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-white"},null,32),t[25]||(t[25]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"PNG, JPEG, WEBP (Max 3MB) - Upload new to replace",-1)),w(U,{name:"fade-down"},{default:k(()=>[b.value?(i(),d("p",bt,c(b.value),1)):x("",!0)]),_:1})]),r("div",xt,[r("button",{type:"submit",disabled:g(l).isLoading,class:"flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:opacity-80 transition disabled:opacity-50 text-sm sm:text-base"},c(g(l).isLoading?"Updating...":"Update Product"),9,yt),r("button",{type:"button",onClick:t[10]||(t[10]=e=>g(E).push(`/products/${g(P).params.id}`)),class:"flex-1 bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-600 transition text-sm sm:text-base"}," Cancel ")])],32))])])]),_:1}))}},St=_(ft,[["__scopeId","data-v-ffb8dc2f"]]);export{St as default};
